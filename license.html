<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AG Grid Enterprise Example</title>
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-grid.css">
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-theme-alpine.css">
</head>
<body>
    <textarea id="dataInput" placeholder="Paste your Excel data here..." rows="5" style="width: 100%;"></textarea>
    <button id="pasteButton">Paste Data</button>
    <div id="myGrid" class="ag-theme-alpine" style="height: 400px; width: 100%; margin-top: 10px;"></div>

    <script src="https://unpkg.com/ag-grid-enterprise/dist/ag-grid-enterprise.min.js"></script>
    <script>
        // Set the AG Grid Enterprise license key
        agGrid.LicenseManager.setLicenseKey('YOUR_LICENSE_KEY_HERE');

        // Define initial column definitions
        let columnDefs = [
            { field: 'isin', headerName: 'ISIN', editable: true },
            { field: 'qty', headerName: 'QTY', editable: true },
            { field: 'direction', headerName: 'Direction', editable: true },
            { field: 'size', headerName: 'Size', editable: true },
        ];

        // Initialize row data with an empty row
        let rowData = [{}];

        // Create the grid
        const gridOptions = {
            columnDefs: columnDefs,
            rowData: rowData,
            domLayout: 'autoHeight',
            defaultColDef: {
                editable: true,  // Allow all cells to be editable
                resizable: true, // Columns are resizable
            },
        };

        // Setup the grid after the page has loaded
        document.addEventListener('DOMContentLoaded', () => {
            const gridDiv = document.querySelector('#myGrid');
            new agGrid.Grid(gridDiv, gridOptions);
        });

        // Handle paste functionality
        document.getElementById('pasteButton').addEventListener('click', () => {
            const clipboardData = document.getElementById('dataInput').value;
            if (clipboardData) {
                const newRows = clipboardData.split('\n').map(row => {
                    const cells = row.split('\t');
                    let newRow = {};
                    // Add data to existing columns (ISIN, QTY, Direction, Size)
                    newRow['isin'] = cells[0] || '';
                    newRow['qty'] = cells[1] || '';
                    newRow['direction'] = cells[2] || '';
                    newRow['size'] = cells[3] || '';

                    // Dynamically add new columns if there are extra fields
                    cells.slice(4).forEach((cellData, index) => {
                        const newField = `col${index + 1}`; // Generate dynamic field names: col1, col2, etc.
                        newRow[newField] = cellData || '';
                        // Add new column definitions if they don't exist
                        if (!gridOptions.columnDefs.some(col => col.field === newField)) {
                            gridOptions.columnDefs.push({ field: newField, headerName: `Column ${index + 1}`, editable: true });
                        }
                    });
                    return newRow;
                });

                // Update the grid with new rows and columns
                gridOptions.api.setColumnDefs(gridOptions.columnDefs);
                gridOptions.api.applyTransaction({ add: newRows });
                document.getElementById('dataInput').value = ''; // Clear input
            }
        });
    </script>
</body>
</html>
